async function fetchUserProfiles(){try{let t=await fetch("https://fa.bdtechnologies.ch/api/v1/profiles");if(!t.ok)throw Error("Failed to fetch user profiles");let e=await t.json();if(console.log(e),!Array.isArray(e.profiles))throw Error("Invalid response format: profiles is not an array");let a=await fetchFavorites();displayUserProfiles(e.profiles,a)}catch(i){console.error(i)}}async function fetchFavorites(){try{let t=await fetch("https://fa.bdtechnologies.ch/api/v1/favorites/");if(!t.ok)throw Error("Failed to fetch favorites");let e=await t.json();if(console.log(e),!e.favorites["123456"]||!e.favorites["123456"])throw Error("Invalid response format: favorites not found");return e.favorites["123456"]}catch(a){return console.error(a),[]}}function displayUserProfiles(t,e){let a=document.getElementById("userProfiles");a.innerHTML="",t.forEach(t=>{let{name:i,id:o,avatar:r}=t,s=e.includes(o),n=`
        <div class="col-md-4 mb-4 ">
          <div class="card">
              <div class="img-body">
              <a class="btn-action">
                  <i class="fa fa-bars"></i>
              </a>
            <img src="${r}" class="card-img-top" alt="Profile Image">
            </div>
            <div class="card-body">
              <h2 class="card-title">${i}</h2>
              <i class="${s?"fas":"far"} fa-star favorite-icon" data-profile-id="${o}"></i>
            </div>
          </div>
        </div>
      `;a.innerHTML+=n});let i=document.querySelectorAll(".favorite-icon");i.forEach(t=>{t.addEventListener("click",toggleFavorite)})}async function toggleFavorite(t){let e=t.target.getAttribute("data-profile-id");try{let a=await fetchFavorites(),i=a.includes(e),o;i?(await removeFavorite(e),o=a.filter(t=>t!==e)):(await addFavorite(e),o=[...a,e]),t.target.classList.toggle("fas"),t.target.classList.toggle("far"),fetchFavorites.favorites=o}catch(r){console.error(r),r.response&&console.error("API Error:",r.response)}}async function addFavorite(t){let e=await fetch("https://fa.bdtechnologies.ch/api/v1/favorites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileId:parseInt(t)})});if(!e.ok)throw Error("Failed to add favorite")}async function removeFavorite(t){let e=`https://fa.bdtechnologies.ch/api/v1/favorites/${t}`,a=await fetch(e,{method:"DELETE"});if(!a.ok)throw Error("Failed to remove favorite")}function fetchUserInfo(t){fetch(`https://fa.bdtechnologies.ch/api/v1/profiles/${t}`).then(t=>t.json()).then(t=>displayUserInfo(t)).catch(t=>console.error(t))}function displayUserInfo(t){document.getElementById("userInfo");let e=document.getElementById("userInfoAge"),a=document.getElementById("userInfoCity"),i=document.getElementById("userInfoAvatar");e.textContent=t.age,a.textContent=t.city,i.setAttribute("src",t.avatar);let o=document.getElementById("userModalLabel");o.textContent=`${t.name} - ${t.relationship_status}`;let r=new bootstrap.Modal(document.getElementById("userModal"));r.show()}document.addEventListener("DOMContentLoaded",()=>{fetchUserProfiles()}),document.addEventListener("click",t=>{if(t.target.classList.contains("card")||t.target.classList.contains("btn-action")){let e=t.target.closest(".card").querySelector(".favorite-icon").getAttribute("data-profile-id");fetchUserInfo(e)}}),document.addEventListener("click",t=>{if("toggleFavoriteBtn"===t.target.id){let e=document.querySelector(".favorite-icon").getAttribute("data-profile-id");toggleFavorite(t,e)}});